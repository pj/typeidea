fragment LogFields on GroupAction {
  hash
  actions {
    ...ActionsFragment
  }
}

fragment TypeFields on Type {
  name
  changeLog
  description
  versions {
    version
    hash
    _type
    fields {
      field {
        name
        description
        changeLog
        optional
        ... on ReferenceField {
          referenceType
          referenceHash
          referenceVersion
        }

        ... on Field {
          _default {
            ... on StringField {
              stringValue: value
            }
            ... on BooleanField {
              booleanValue: value
            }
            ... on FloatField {
              floatValue: value
            }
            ... on IntegerField {
              intValue: value
            }
          }
          type
        }
      }
    }
  }
}

fragment ServiceFields on Service {
  name
  description
  changeLog
  versions {
    inputs {
      version
      _type
      hash
    }

    output {
      version
      _type
      hash
    }
  }
}

fragment ChangeSetFields on ChangeSet {
  id
  baseHash
  log {
      ...ChangeActionsFragment
  }
}

query allData {
  log {
    ...LogFields
  }

  types {
    ...TypeFields
  }

  services {
    ...ServiceFields
  }

  changeSets {
    ...ChangeSetFields
  }
}

fragment DataFragment on FieldDefaults {
  ... on StringField {
    __typename
    stringValue: value
  }

  ... on IntegerField {
    __typename
    intValue: value
  }

  ... on FloatField {
    __typename
    floatValue: value
  }

  ... on BooleanField {
    __typename
    booleanValue: value
  }
}

fragment ActionsFragment on Action {
  ... on NewServiceAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    serviceName
    description
  }

  ... on UpdateDescriptionServiceAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    serviceName
    description
  }

  ... on AddVersionServiceAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    serviceName
    inputType
    outputType
    inputVersion
    inputHash
    outputVersion
    outputHash
  }

  ... on RenameFieldTypeAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    typeName
    _from
    to
  }

  ... on RequiredFieldTypeAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    typeName
    name
  }

  ... on OptionalFieldTypeAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    typeName
    name
  }

  ... on DeleteFieldTypeAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    typeName
    name
  }

  ... on SetDefaultFieldTypeAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    typeName
    name
    newDefault: _default {
      ...DataFragment
    }
  }

  ... on RemoveDefaultFieldTypeAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    typeName
    name
  }

  ... on AddFieldTypeAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    typeName
    name
    _type
    description
    optional
    _default {
      ...DataFragment
    }
  }

  ... on UpdateDescriptionTypeAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    typeName
    name
    description
  }

  ... on ReferenceFieldTypeAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    typeName
    name
    description
    optional
    referenceType
    referenceHash
    referenceVersion
  }

  ... on NewTypeAction {
    __typename
    changeLog
    hash
    _id: hash
    version
    typeName
    description
  }
}

fragment ChangeActionsFragment on ChangeAction {
  ... on NewServiceChangeAction {
    __typename
    changeLog
    serviceName
    description
  }

  ... on UpdateDescriptionServiceChangeAction {
    __typename
    changeLog
    serviceName
    description
  }

  ... on AddVersionServiceChangeAction {
    __typename
    changeLog
    serviceName
    inputType
    outputType
    inputVersion
    inputHash
    outputVersion
    outputHash
  }

  ... on RenameFieldTypeChangeAction {
    __typename
    changeLog
    typeName
    _from
    to
  }

  ... on RequiredFieldTypeChangeAction {
    __typename
    changeLog
    typeName
    name
  }

  ... on OptionalFieldTypeChangeAction {
    __typename
    changeLog
    typeName
    name
  }

  ... on DeleteFieldTypeChangeAction {
    __typename
    changeLog
    typeName
    name
  }

  ... on SetDefaultFieldTypeChangeAction {
    __typename
    changeLog
    typeName
    name
    newDefault: _default {
      ...DataFragment
    }
  }

  ... on RemoveDefaultFieldTypeChangeAction {
    __typename
    changeLog
    typeName
    name
  }

  ... on AddFieldTypeChangeAction {
    __typename
    changeLog
    typeName
    name
    _type
    description
    optional
    _default {
      ...DataFragment
    }
  }

  ... on UpdateDescriptionTypeChangeAction {
    __typename
    changeLog
    typeName
    name
    description
  }

  ... on ReferenceFieldTypeChangeAction {
    __typename
    changeLog
    typeName
    name
    description
    optional
    referenceType
    referenceHash
    referenceVersion
  }

  ... on NewTypeChangeAction {
    __typename
    changeLog
    typeName
    description
  }
}

fragment ChangeSetFragment on ChangeSet {
  id
  baseHash
  log {
    ...ChangeActionsFragment
  }
}

mutation UpdateChangeSet($changeSet: ChangeSetInput!) {
  updateChangeSet(changeSet: $changeSet) {
    ...ChangeSetFragment
  }
}

mutation CommitChangeSet($changeSetId: String!) {
  commitChangeSet(changeSetId: $changeSetId) {
    log {
      ...LogFields
    }

    types {
      ...TypeFields
    }

    services {
      ...ServiceFields
    }

    changeSets {
      ...ChangeSetFields
    }
  }
}